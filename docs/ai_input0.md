# 项目概述

我准备编写一个网页版大逃杀游戏。游戏实际运行时，会在每晚9点05到9点20之间开放玩家**行动**（Action）。**行动**是指玩家在该时间段内可以执行的一系列操作的集合。玩家在网页上操作自己的角色进行移动、搜索、攻击、使用道具等操作。

## 技术架构

- 前端：采用vue3+ts+vite进行开发，采用csr部署，挂载到nginx服务器上
- 后端：采用rust开发，实现两个核心功能：
  1. 处理由nginx服务器转发来的API调用（REST API）
  2. 直接WebSocket连接，处理玩家的实时操作

## 文档需求

需要生成以下文档：
- QWEN.md（用于指导模型生成，一共生成三个：项目总描述和两个分项目）
- PRD.md（两个分项目用于描述产品需求）
- API接口规范（存入`docs/api-spec.md`中，应包含请求/响应格式、状态码、认证方式等）
- 游戏规则（存储到`docs/game-rules.md`中，应包含玩法、指令、属性等说明）

## 数据存储策略

- 静态数据（如玩家名称、密码）存储到MySQL数据库中（已建立好）
- 动态内容只在内存中进行，行动结束时统一保存成本地文件
- 所有需求和文档都使用中文编写

## 核心界面

最核心的两个界面：
1. 玩家的游玩交互界面
2. 导演的后台监控操作界面
此外还应该有基础的登录界面以及系统管理员后台设置游戏界面。

## 系统逻辑

- 由后台管理员创建游戏，管理员设置游戏名称和简介，并设置一个**游戏管理密码**，将游戏ID和管理密码分发给导演。
- 导演使用**游戏管理密码**进入该游戏的控制台进行设置，可以添加演员（即玩家）使用的登录帐号（注意演员帐号的密码应当明文存储，一般是六到八位字母数字，演员不允许修改密码）。
- 玩家在主页选择某一场游戏后，弹出该场游戏的登录页面，每名玩家输入自己的**演员密码**（无需用户名）即可登录。登录后进入游戏交互页面，在游戏时间以外无法操作。
- **设计说明**：为了简化用户体验，导演和演员的交互界面URI中可以包含明文密码，以便直接访问。**请注意，这在实际生产环境中存在安全风险，仅为本项目特定设计**。
- 导演和演员都可以通过包含密码的URI直接访问导演控制台或玩家操作界面，无需额外的权限认证。

## 旧系统参考

在`python_directors`目录中已经有旧版大逃杀结算系统，它通过python flask实现，通过表单提交行动、自动刷新的方式与玩家交互，技术十分落后呆滞。新系统需要对这一系列进行翻新，只参考旧系统功能，不调用或复用旧系统中的任何类型或定义。相关的规则文件位于`html_rules.md`。

## 开发环境

开发将在vscode中进行，使用git进行版本控制。

## 项目架构

目前设计的架构大致如下：
royale-arena/
├── QWEN.md              # 项目总览
├── frontend/QWEN.md     # 前端上下文
├── backend/QWEN.md      # 后端上下文
├── frontend/PRD.md      # 前端需求
├── backend/PRD.md       # 后端需求
└── docs/
    ├── api-spec.md      # API规范
    ├── game-rules.md    # 游戏规则
    └── html_rules.md    # 参考的旧规则文件

## 特别约束说明

### 1. 游戏机制约束：
- 地图大小：有至多约50个不同的地点
- 最大玩家数：100人
- 游戏时长：15~30分钟（比如21:05-21:20，由导演在后台设置）
- 安全区逐步缩小机制
- 玩家通过单个指令来完成行动：移动、搜索、攻击、使用道具等。具体可以参考`html_rules.md`和旧版系统。注意，规则文件中规定的**初始数值**（如初始生命、体力、搜索概率等）以及旧系统中很多写死的常量在新系统中都应该是导演可以自由操控的、灵活的。
- 导演控制台支持空投物资，修改玩家数值、物品等后台操作、缩圈设置、开始结束行动时间设置等操作
- 玩家有生命和体力两条主要属性（接口应当易于后续扩展，未来可能会加入诸如金币或者购买之类的系统）

### 2. 技术约束：
- 不使用任何现有的游戏引擎
- 不集成第三方实时通信服务
- 不使用ORM框架操作MySQL
- 前端状态管理应使用Pinia或Vuex

### 3. 数据流约束：
- WebSocket只处理实时操作指令
- REST API只处理用户认证、游戏状态查询
- 游戏过程中不访问数据库

### 4. 兼容性约束：
- 只参考旧系统的功能列表和`html_rules.md`的内容
- 不查看、不调用、不复用`python_directors`中的任何代码