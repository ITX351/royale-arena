# 后台代码清理任务清单

这个清单用于跟踪需要清理和完善的后台代码，特别是那些目前只是占位符的实现。

## 模型层 (Models)

### 游戏模型 (Game)
- [x] 实现完整的测试覆盖，包括状态转换测试
- [x] 添加更多字段的验证逻辑

### 玩家模型 (Player)
- [x] 实现完整的测试覆盖，包括状态转换测试
- [x] 添加密码哈希存储而不是明文存储
- [x] 添加更多字段的验证逻辑

### 规则模型 (GameRules)
- [x] 实现完整的测试覆盖，包括各种规则组合的测试
- [x] 添加规则验证逻辑

### 地点模型 (Place)
- [x] 实现完整的测试覆盖
- [x] 添加地点状态管理逻辑

### 规则模板模型 (RuleTemplate)
- [x] 实现完整的测试覆盖
- [x] 添加模板验证逻辑

## 服务层 (Services)

### 数据库服务 (db.rs, db_helper.rs)
- [x] 实现连接池的配置和管理
- [x] 添加数据库连接错误的详细日志

### 管理员服务 (admin_service.rs)
- [x] 实现完整的测试覆盖（需要数据库）
- [x] 添加管理员权限验证逻辑

### 游戏管理服务 (admin_game_service.rs)
- [x] 实现完整的测试覆盖（需要数据库）
- [x] 添加游戏状态验证逻辑

### 游戏服务 (game_service.rs)
- [x] 实现从内存或数据库获取游戏规则的逻辑
- [x] 实现完整的测试覆盖
- [x] 添加游戏数据缓存逻辑
- [x] 完善从数据库获取游戏信息的逻辑

## 处理层 (Handlers)

### 游戏处理 (game.rs)
- [x] 实现从内存和数据库获取游戏信息的完整逻辑
- [x] 添加错误处理和日志记录

### 管理员处理 (admin.rs)
- [x] 实现密码哈希验证而不是明文比较
- [x] 添加JWT令牌生成和验证

### 规则处理 (rules.rs)
- [x] 实现游戏存在性检查
- [x] 实现从服务层获取游戏规则的逻辑
- [x] 实现完整的测试覆盖

### 玩家处理 (player.rs)
- [x] 实现游戏存在性检查
- [x] 实现从游戏数据中获取真实玩家信息的逻辑 (TODO注释)
- [x] 添加玩家身份验证逻辑
- [x] 实现完整的测试覆盖

### 地点处理 (places.rs)
- [x] 实现游戏存在性检查
- [x] 实现从游戏数据中获取真实地点信息的逻辑
- [x] 添加地点状态更新逻辑
- [x] 实现完整的测试覆盖

## 其他

### 测试工具 (test_utils.rs)
- [x] 添加更多测试辅助函数
- [x] 实现测试数据库连接和数据清理

### 集成测试
- [x] 创建tests目录并添加集成测试
- [x] 实现API端点的完整测试覆盖