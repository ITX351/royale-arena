# 目录结构详解

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [docker-compose.yml](file://docker-compose.yml)
- [backend/Cargo.toml](file://backend\Cargo.toml)
- [backend/src/main.rs](file://backend\src\main.rs)
- [backend/src/routes.rs](file://backend\src\routes.rs)
- [backend/src/admin/service.rs](file://backend\src\admin\service.rs)
- [backend/src/auth/service.rs](file://backend\src\auth\service.rs)
- [backend/src/database.rs](file://backend\src\database.rs)
- [frontend/package.json](file://frontend\package.json)
- [frontend/src/main.ts](file://frontend\src\main.ts)
- [python_directors/server.py](file://python_directors\server.py)
- [python_directors/main.py](file://python_directors\main.py)
</cite>

## 目录结构

royale-arena 项目采用模块化架构，分为前端、后端和导演控制三大核心部分，通过 Docker 统一编排部署。整体结构清晰，职责分明。

``mermaid
graph TB
subgraph "根目录"
A[docker-compose.yml]
B[README.md]
C[QWEN.md]
end
subgraph "后端 (Rust)"
D[backend]
D1[src]
D2[migrations]
D3[sql]
D1 --> D2
D1 --> D3
end
subgraph "前端 (Vue 3)"
E[frontend]
E1[src]
E2[components]
E3[views]
E4[stores]
end
subgraph "Python 导演工具"
F[python_directors]
F1[templates]
F2[server.py]
F3[main.py]
end
A --> D
A --> E
A --> F
```

**图示来源**  
- [docker-compose.yml](file://docker-compose.yml#L1-L68)
- 项目目录结构

## 项目核心模块解析

### 后端模块 (backend)

后端采用 Rust 语言开发，基于 Axum 框架构建高性能 Web 服务，负责游戏逻辑处理、数据库交互和 API 提供。

#### 目录结构
- **src**: 核心后端服务源代码
- **migrations**: 数据库迁移脚本管理
- **sql**: 存放数据库初始化脚本

#### 核心子模块
**src 目录**  
包含后端主程序代码，采用模块化设计：
- **admin**: 管理员管理模块，包含用户管理、权限控制等功能
- **auth**: 认证授权模块，实现 JWT 认证机制
- **bin**: 可执行程序入口，如管理员初始化脚本
- **config.rs**: 应用配置管理，从环境变量加载配置
- **database.rs**: 数据库连接池管理
- **errors.rs**: 统一错误处理机制
- **main.rs**: 应用主入口，初始化服务并启动服务器
- **routes.rs**: 路由定义，配置 API 端点

**migrations 目录**  
用于管理数据库版本控制，包含初始化和测试数据的上下迁移脚本：
- `20250825105153_init_schema.up.sql`: 初始化数据库结构
- `20250825105153_init_schema.down.sql`: 回滚数据库结构
- `20250825105158_seed_test_data.up.sql`: 插入测试数据
- `20250825105158_seed_test_data.down.sql`: 清除测试数据
- `README.md`: 迁移脚本使用说明

**sql 目录**  
存放原始 SQL 脚本，用于快速初始化数据库环境。

``mermaid
erDiagram
admin_users ||--o{ games : "管理"
games ||--o{ actors : "包含"
games ||--o{ game_logs : "记录"
games ||--o{ kill_records : "包含"
rule_templates ||--o{ games : "应用"
admin_users {
string id PK
string username UK
string password
boolean is_super_admin
}
games {
string id PK
string name
string director_password
enum status
string rule_template_id FK
}
actors {
string id PK
string game_id FK
string name
string password
int team_id
}
rule_templates {
string id PK
string template_name
json rules_config
}
game_logs {
string id PK
string game_id FK
enum level
text message
string player_id FK
}
kill_records {
string id PK
string game_id FK
string killer_id FK
string victim_id FK
string cause
}
```

**图示来源**  
- [backend/src/database.rs](file://backend\src\database.rs#L1-L8)

**本节来源**  
- [backend/Cargo.toml](file://backend\Cargo.toml#L1-L42)
- [backend/src/main.rs](file://backend\src\main.rs#L1-L57)
- [backend/src/routes.rs](file://backend\src\routes.rs#L1-L42)
- [backend/src/admin/service.rs](file://backend\src\admin\service.rs#L1-L172)
- [backend/src/auth/service.rs](file://backend\src\auth\service.rs#L1-L81)

### 前端模块 (frontend)

前端采用 Vue 3 + TypeScript + Vite 技术栈，提供现代化的响应式用户界面。

#### 目录结构
- **src**: 前端主项目源代码
- **QWEN.md**: 前端上下文说明
- **README.md**: 前端项目说明

#### 源码组织 (src)
**components**: 可复用的 UI 组件
- `HelloWorld.vue`: 基础组件示例

**App.vue**: 应用根组件，定义页面结构

**main.ts**: 应用入口文件，初始化 Vue 实例

**style.css**: 全局样式文件

**vite-env.d.ts**: Vite 环境类型定义

``mermaid
graph TB
App[App.vue] --> Main[main.ts]
Main --> Vue[createApp]
Main --> Style[style.css]
App --> HelloWorld[HelloWorld.vue]
style App fill:#42b883,stroke:#35495e
style Main fill:#42b883,stroke:#35495e
```

**图示来源**  
- [frontend/src/main.ts](file://frontend\src\main.ts#L1-L6)
- [frontend/src/App.vue](file://frontend\src\App.vue)

**本节来源**  
- [frontend/package.json](file://frontend\package.json#L1-L22)
- [frontend/src/main.ts](file://frontend\src\main.ts#L1-L6)
- [frontend/src/App.vue](file://frontend\src\App.vue)

### Python 导演工具模块 (python_directors)

该模块为游戏导演提供控制界面和管理功能，使用 Python 实现。

#### 核心文件
- `server.py`: HTTP 服务器入口
- `main.py`: 主程序逻辑
- `action.py`: 行动处理
- `data.py`: 数据管理
- `user.py`: 用户管理
- `message.py`: 消息处理
- `constants.py`: 常量定义
- `requirements.txt`: Python 依赖包列表

#### 模板系统
**templates 目录**  
存放 HTML 模板文件：
- `login.html`: 登录页面
- `view.html`: 游戏视图
- `view_all.html`: 全局视图

此模块作为导演控制台，可能通过 Web 界面与后端 API 交互，实现游戏进程控制。

**本节来源**  
- [python_directors/server.py](file://python_directors\server.py)
- [python_directors/main.py](file://python_directors\main.py)

## 根目录关键文件

### docker-compose.yml
Docker 编排文件，定义了完整的开发环境：

```yaml
services:
  mysql:        # MySQL 数据库
  adminer:      # 数据库管理工具
```

服务间通过 `discuz_net` 网络通信，实现容器化开发环境的一键启动。当前后端和前端服务配置被注释，仅运行数据库相关服务。

### README.md
项目主说明文件，包含：
- 项目简介：基于网页的大逃杀游戏
- 技术架构：Vue 3 + Rust + Nginx
- 开发指令：前后端启动命令
- 文档指引：API 规范、游戏规则等

### QWEN.md
项目上下文说明文件，分布在根目录、前端和后端目录中，提供各模块的背景信息。

**本节来源**  
- [docker-compose.yml](file://docker-compose.yml#L1-L68)
- [README.md](file://README.md#L1-L56)