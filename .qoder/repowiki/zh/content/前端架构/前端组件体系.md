# 前端组件体系

<cite>
**本文档中引用的文件**  
- [App.vue](file://frontend\src\App.vue) - *根组件，已更新*
- [HomePage.vue](file://frontend\src\views\HomePage.vue) - *新增首页组件*
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue) - *新增管理员登录页面*
- [GameCard.vue](file://frontend\src\components\GameCard.vue) - *游戏卡片组件*
- [index.ts](file://frontend\src\router\index.ts) - *路由配置，已更新*
- [game.ts](file://frontend\src\stores\game.ts) - *游戏状态管理*
- [admin.ts](file://frontend\src\stores\admin.ts) - *管理员状态管理*
- [game.ts](file://frontend\src\types\game.ts) - *游戏类型定义*
- [admin.ts](file://frontend\src\types\admin.ts) - *管理员类型定义*
</cite>

## 更新摘要
**变更内容**   
- 新增了首页组件 `HomePage.vue` 和管理员登录页面 `AdminLoginPage.vue`
- 更新了根组件 `App.vue` 的结构和路由配置
- 新增了游戏卡片组件 `GameCard.vue` 用于展示游戏列表
- 更新了组件体系架构图以反映新的组件关系
- 添加了状态管理（Pinia store）和类型定义的文档说明

## 目录
1. [项目结构概览](#项目结构概览)
2. [Vue 3组合式API组件化设计模式](#vue-3组合式api组件化设计模式)
3. [根组件App.vue的结构与职责](#根组件appvue的结构与职责)
4. [基础组件体系分析](#基础组件体系分析)
5. [路由视图组件实现机制](#路由视图组件实现机制)
6. [组件通信机制详解](#组件通信机制详解)
7. [SVG图标封装与复用策略](#svg图标封装与复用策略)
8. [状态管理与类型系统](#状态管理与类型系统)
9. [组件体系架构图](#组件体系架构图)

## 项目结构概览

royale-arena前端项目采用标准的Vue 3 + Vite项目结构，遵循功能模块化组织原则。核心组件分布在`src`目录下的不同子目录中：

- `components/`: 存放可复用的基础UI组件
- `views/`: 存放路由级别的视图组件
- `views/admin/`: 存放管理员后台视图组件
- `router/`: 路由配置
- `stores/`: 状态管理（Pinia）
- `types/`: TypeScript类型定义
- `services/`: API服务封装
- `App.vue`: 根组件
- `main.ts`: 应用入口

这种结构清晰地分离了不同类型的组件，便于维护和扩展。

**Section sources**
- [App.vue](file://frontend\src\App.vue)
- [main.ts](file://frontend\src\main.ts)

## Vue 3组合式API组件化设计模式

项目全面采用Vue 3的组合式API（Composition API）和`<script setup>`语法糖，这是一种现代化的组件开发模式，具有以下特点：

1. **更简洁的语法**：`<script setup>`语法允许直接在模板中使用导入的组件和声明的变量，无需显式注册或返回
2. **更好的类型推导**：与TypeScript集成更紧密，提供更好的类型安全
3. **逻辑组织更灵活**：可以按逻辑关注点组织代码，而不是强制按照选项（data, methods等）分组

例如，在`HomePage.vue`中，使用`defineProps`宏来声明组件属性，这是组合式API特有的语法：

```vue
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import GameCard from '@/components/GameCard.vue'
import { useGameStore } from '@/stores/game'
</script>
```

这种模式使得组件API定义更加直观和类型安全。

**Section sources**
- [HomePage.vue](file://frontend\src\views\HomePage.vue#L1-L307)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue#L1-L230)
- [GameCard.vue](file://frontend\src\components\GameCard.vue#L1-L288)

## 根组件App.vue的结构与职责

`App.vue`作为应用的根组件，承担着组织整体页面结构和布局的核心职责。

```vue
<script setup lang="ts">
import { onMounted } from 'vue'
import { useAdminStore } from '@/stores/admin'

const adminStore = useAdminStore()

// 初始化时检查登录状态
onMounted(() => {
  adminStore.initAuth()
})
</script>

<template>
  <div id="app">
    <router-view />
  </div>
</template>
```

其主要职责包括：

1. **应用初始化**：在组件挂载时调用`adminStore.initAuth()`检查管理员登录状态
2. **全局状态管理**：引入并使用Pinia store进行状态管理
3. **路由视图占位**：使用`<router-view />`组件作为路由内容的渲染出口

`App.vue`通过组合式API导入所需组件和状态管理功能，实现了简洁而高效的根组件设计。

**Section sources**
- [App.vue](file://frontend\src\App.vue#L1-L63)

## 基础组件体系分析

### HomePage.vue组件

`HomePage.vue`是新的首页视图组件，主要职责是展示游戏列表和提供用户交互功能。

```vue
<template>
  <div class="home-page">
    <!-- 顶部导航 -->
    <header class="header">
      <div class="container">
        <div class="header-content">
          <div class="logo-section">
            <h1 class="logo">Royale Arena</h1>
          </div>
          
          <div class="search-section">
            <el-input
              v-model="gameStore.searchQuery"
              placeholder="搜索游戏..."
              :prefix-icon="Search"
              class="search-input"
              clearable
            />
            <el-select 
              v-model="gameStore.statusFilter" 
              placeholder="状态筛选" 
              class="status-filter"
            >
              <el-option label="全部" value="all" />
              <el-option label="活动中" value="active" />
              <el-option label="等待中" value="waiting" />
              <el-option label="进行中" value="running" />
              <el-option label="已结束" value="ended" />
              <el-option label="已隐藏" value="hidden" />
            </el-select>
          </div>
          
          <div class="admin-section">
            <el-button 
              @click="refreshGames"
              :loading="gameStore.loading"
              :icon="Refresh"
              circle
              title="刷新游戏列表"
            />
            <el-button 
              type="primary" 
              @click="goToAdminLogin"
              :icon="User"
            >
              管理员登录
            </el-button>
          </div>
        </div>
      </div>
    </header>

    <!-- 主要内容 -->
    <main class="main-content">
      <div class="container">
        <!-- 错误提示 -->
        <el-alert
          v-if="gameStore.error"
          :title="gameStore.error"
          type="error"
          :closable="true"
          @close="gameStore.clearError"
          class="error-alert"
        />
        
        <!-- 游戏列表 -->
        <div class="games-grid" v-loading="gameStore.loading">
          <GameCard
            v-for="game in paginatedGames"
            :key="game.id"
            :game="game"
            @view-detail="handleViewGameDetail"
          />
        </div>
        
        <!-- 空状态 -->
        <div v-if="!gameStore.loading && gameStore.filteredGames.length === 0" class="empty-state">
          <el-empty 
            :description="getEmptyStateText()"
            :image-size="200"
          >
            <el-button type="primary" @click="resetFilters">
              重置筛选
            </el-button>
          </el-empty>
        </div>
        
        <!-- 分页 -->
        <div class="pagination-wrapper" v-if="gameStore.filteredGames.length > pageSize">
          <el-pagination
            v-model:current-page="currentPage"
            :page-size="pageSize"
            :total="gameStore.filteredGames.length"
            layout="prev, pager, next, jumper, total"
            @current-change="handlePageChange"
          />
        </div>
      </div>
    </main>
  </div>
</template>
```

该组件的主要功能包括：
- **游戏列表展示**：使用`GameCard`组件展示游戏列表
- **搜索与筛选**：提供搜索框和状态筛选下拉菜单
- **分页功能**：支持分页显示游戏列表
- **状态管理**：通过`useGameStore()`访问游戏状态
- **用户交互**：提供刷新、登录管理员等按钮

### GameCard.vue组件

`GameCard.vue`是一个基础布局组件，用于展示单个游戏的信息。

```vue
<template>
  <el-card class="game-card" :class="getGameStatusClass(game.status)">
    <template #header>
      <div class="card-header">
        <div class="title-section">
          <h3 class="game-title">{{ game.name }}</h3>
          <p class="game-description" v-if="game.description">{{ game.description }}</p>
        </div>
        <el-tag 
          :type="getGameStatusConfig(game.status).type" 
          :color="getGameStatusConfig(game.status).color"
          size="small"
        >
          {{ getGameStatusConfig(game.status).text }}
        </el-tag>
      </div>
    </template>
    
    <div class="game-info">
      <!-- 玩家数量信息 -->
      <div class="info-item">
        <el-icon><User /></el-icon>
        <span class="info-label">玩家数量：</span>
        <span class="info-value">{{ game.player_count || 0 }}/{{ game.max_players }}</span>
      </div>
      
      <!-- 创建时间 -->
      <div class="info-item">
        <el-icon><Clock /></el-icon>
        <span class="info-label">创建时间：</span>
        <span class="info-value">{{ formatDateTime(game.created_at) }}</span>
      </div>
      
      <!-- 规则模版信息 -->
      <div class="info-item" v-if="game.rule_template">
        <el-icon><Document /></el-icon>
        <span class="info-label">规则模版：</span>
        <span class="info-value">{{ game.rule_template.template_name }}</span>
      </div>
    </div>
    
    <!-- 游戏操作区域 -->
    <div class="game-actions">
      <!-- 快捷登录区域 -->
      <div class="quick-login" v-if="canQuickLogin">
        <div class="login-input-group">
          <el-input 
            v-model="loginPassword" 
            type="password"
            placeholder="输入密码快速加入"
            size="small"
            show-password
            @keyup.enter="handleQuickLogin"
          >
            <template #append>
              <el-button 
                type="primary" 
                :loading="loginLoading"
                @click="handleQuickLogin"
                size="small"
              >
                登录
              </el-button>
            </template>
          </el-input>
        </div>
        <div class="login-hint">
          <span class="hint-text">输入密码后自动识别身份进入游戏</span>
        </div>
      </div>
      
      <!-- 详情按钮 -->
      <el-button 
        type="info" 
        size="default"
        @click="$emit('view-detail', game)"
        class="detail-button"
        plain
      >
        <el-icon><View /></el-icon>
        查看详情
      </el-button>
    </div>
  </el-card>
</template>
```

该组件的主要特点：
- **状态样式**：根据游戏状态显示不同的边框颜色
- **快捷登录**：提供密码输入框，支持玩家/导演快速登录
- **事件发射**：通过`$emit('view-detail', game)`向父组件传递查看详情事件
- **响应式设计**：适配不同屏幕尺寸

**Section sources**
- [HomePage.vue](file://frontend\src\views\HomePage.vue#L1-L307)
- [GameCard.vue](file://frontend\src\components\GameCard.vue#L1-L288)

## 路由视图组件实现机制

### HomePage.vue组件

`HomePage.vue`作为首页视图组件，是应用的主要入口：

```vue
<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import { Search, User, Refresh } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import GameCard from '@/components/GameCard.vue'
import { useGameStore } from '@/stores/game'
import type { GameListItem } from '@/types/game'

const router = useRouter()
const gameStore = useGameStore()

// 响应式数据
const currentPage = ref(1)
const pageSize = ref(12)

// 计算属性
const paginatedGames = computed(() => {
  const start = (currentPage.value - 1) * pageSize.value
  const end = start + pageSize.value
  return gameStore.filteredGames.slice(start, end)
})

// 方法
const handleViewGameDetail = (game: GameListItem) => {
  router.push(`/game/${game.id}`)
}

const handlePageChange = (page: number) => {
  currentPage.value = page
  // 滚动到页面顶部
  window.scrollTo({ top: 0, behavior: 'smooth' })
}

const goToAdminLogin = () => {
  router.push('/admin/login')
}

const resetFilters = () => {
  gameStore.setSearchQuery('')
  gameStore.setStatusFilter('all')
  currentPage.value = 1
}

const getEmptyStateText = () => {
  if (gameStore.statusFilter === 'hidden') {
    return '没有找到已隐藏的游戏'
  }
  if (gameStore.searchQuery.trim()) {
    return `没有找到与 "${gameStore.searchQuery}" 相关的游戏`
  }
  return '暂无游戏，请联系管理员创建游戏'
}

// 手动刷新功能
const refreshGames = async () => {
  await gameStore.refreshGames()
  ElMessage.success('刷新成功')
}

// 监听筛选条件变化，重置页码
watch([() => gameStore.searchQuery, () => gameStore.statusFilter], () => {
  currentPage.value = 1
})

// 生命周期
onMounted(async () => {
  await gameStore.loadGames()
})
</script>
```

该组件的主要职责：
- **数据加载**：在`onMounted`生命周期中调用`gameStore.loadGames()`加载游戏列表
- **状态管理**：通过`useGameStore()`访问和修改游戏状态
- **用户交互**：处理搜索、筛选、分页等用户操作
- **路由导航**：通过`router.push()`实现页面跳转

### AdminLoginPage.vue组件

`AdminLoginPage.vue`是管理员登录页面：

```vue
<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, type FormInstance, type FormRules } from 'element-plus'
import { UserFilled, User, Lock, Right, ArrowLeft } from '@element-plus/icons-vue'
import { useAdminStore } from '@/stores/admin'
import type { LoginCredentials } from '@/types/admin'

const router = useRouter()
const adminStore = useAdminStore()

// 表单引用
const loginFormRef = ref<FormInstance>()

// 表单数据
const loginForm = reactive<LoginCredentials>({
  username: '',
  password: ''
})

// 其他状态
const rememberLogin = ref(true)

// 表单验证规则
const loginRules: FormRules = {
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' }
  ]
}

// 处理登录
const handleLogin = async () => {
  if (!loginFormRef.value) return

  // 表单验证
  const isValid = await loginFormRef.value.validate().catch(() => false)
  if (!isValid) return

  // 执行登录
  const result = await adminStore.login(loginForm)
  
  if (result.success) {
    ElMessage.success('登录成功')
    router.push('/admin/games')
  }
}

// 返回首页
const goToHome = () => {
  router.push('/')
}

// 初始化检查登录状态
adminStore.initAuth()
</script>
```

该组件的主要功能：
- **表单验证**：使用Element Plus的表单验证功能
- **登录处理**：调用`adminStore.login()`执行登录操作
- **状态持久化**：通过`localStorage`保存登录状态
- **路由守卫**：在`initAuth()`中检查登录状态

### Vue Router集成

路由配置在`src/router/index.ts`文件中：

```ts
import { createRouter, createWebHistory } from 'vue-router'
import { useAdminStore } from '@/stores/admin'

// 懒加载组件
const HomePage = () => import('@/views/HomePage.vue')
const GameDetailPage = () => import('@/views/GameDetailPage.vue')
const PlayerInterface = () => import('@/views/PlayerInterface.vue')
const DirectorConsole = () => import('@/views/DirectorConsole.vue')
const AdminLoginPage = () => import('@/views/admin/AdminLoginPage.vue')
const AdminLayout = () => import('@/views/admin/AdminLayout.vue')
const AdminGamesPage = () => import('@/views/admin/AdminGamesPage.vue')
const AdminRulesPage = () => import('@/views/admin/AdminRulesPage.vue')
const AdminUsersPage = () => import('@/views/admin/AdminUsersPage.vue')

const routes = [
  // 公共路由
  {
    path: '/',
    name: 'Home',
    component: HomePage,
    meta: {
      title: 'Royale Arena - 首页'
    }
  },
  {
    path: '/game/:id',
    name: 'GameDetail',
    component: GameDetailPage,
    meta: {
      title: '游戏详情'
    }
  },
  {
    path: '/game/:id/player',
    name: 'PlayerInterface',
    component: PlayerInterface,
    meta: {
      title: '玩家界面'
    }
  },
  {
    path: '/game/:id/director',
    name: 'DirectorConsole',
    component: DirectorConsole,
    meta: {
      title: '导演控制台'
    }
  },
  
  // 管理员登录路由
  {
    path: '/admin/login',
    name: 'AdminLogin',
    component: AdminLoginPage,
    meta: {
      title: '管理员登录'
    }
  },
  
  // 管理员后台路由（需要认证）
  {
    path: '/admin',
    component: AdminLayout,
    meta: {
      requiresAuth: true,
      title: '管理后台'
    },
    redirect: '/admin/games',
    children: [
      {
        path: 'games',
        name: 'AdminGames',
        component: AdminGamesPage,
        meta: {
          title: '游戏管理'
        }
      },
      {
        path: 'rules',
        name: 'AdminRules',
        component: AdminRulesPage,
        meta: {
          title: '规则模版管理'
        }
      },
      {
        path: 'admins',
        name: 'AdminUsers',
        component: AdminUsersPage,
        meta: {
          requiresSuperAdmin: true,
          title: '管理员管理'
        }
      }
    ]
  },
  
  // 404 重定向
  {
    path: '/:pathMatch(.*)*',
    redirect: '/'
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// 路由守卫
router.beforeEach((to, from, next) => {
  const adminStore = useAdminStore()
  
  // 设置页面标题
  if (to.meta.title) {
    document.title = to.meta.title as string
  }
  
  // 检查是否需要管理员认证
  if (to.meta.requiresAuth) {
    if (!adminStore.isLoggedIn) {
      next('/admin/login')
      return
    }
    
    // 检查是否需要超级管理员权限
    if (to.meta.requiresSuperAdmin && !adminStore.isSuperAdmin) {
      next('/admin/games')
      return
    }
  }
  
  // 如果已登录管理员访问登录页，重定向到后台
  if (to.name === 'AdminLogin' && adminStore.isLoggedIn) {
    next('/admin/games')
    return
  }
  
  next()
})

export default router
```

路由配置展示了以下特点：
1. **懒加载**：所有组件都使用`() => import()`实现代码分割和懒加载
2. **路由元信息**：使用`meta`字段存储页面标题和权限要求
3. **路由守卫**：通过`beforeEach`实现认证和权限检查
4. **嵌套路由**：管理员后台使用嵌套路由组织子页面

**Section sources**
- [HomePage.vue](file://frontend\src\views\HomePage.vue#L1-L307)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue#L1-L230)
- [index.ts](file://frontend\src\router\index.ts#L1-L142)

## 组件通信机制详解

### Props通信

组件间通信主要通过props实现，如`GameCard.vue`中的示例：

```vue
<script setup lang="ts">
import type { GameListItem } from '@/types/game'

interface Props {
  game: GameListItem
}

const props = defineProps<Props>()
</script>
```

父组件`HomePage.vue`通过属性绑定传递数据：
```vue
<GameCard
  v-for="game in paginatedGames"
  :key="game.id"
  :game="game"
  @view-detail="handleViewGameDetail"
/>
```

### Emits通信

项目广泛使用emits机制实现子组件向父组件通信，`GameCard.vue`定义了事件：

```vue
<script setup lang="ts">
import type { GameListItem } from '@/types/game'

defineEmits<{
  'view-detail': [game: GameListItem]
}>()
</script>
```

当用户点击"查看详情"按钮时，触发事件：
```vue
<el-button 
  type="info" 
  size="default"
  @click="$emit('view-detail', game)"
  class="detail-button"
  plain
>
  <el-icon><View /></el-icon>
  查看详情
</el-button>
```

父组件`HomePage.vue`监听该事件：
```vue
<GameCard
  v-for="game in paginatedGames"
  :key="game.id"
  :game="game"
  @view-detail="handleViewGameDetail"
/>
```

### 状态管理通信

项目使用Pinia进行全局状态管理，`HomePage.vue`通过`useGameStore()`访问游戏状态：

```ts
import { useGameStore } from '@/stores/game'

const gameStore = useGameStore()
```

组件可以直接访问store中的状态和操作：
```vue
<el-input
  v-model="gameStore.searchQuery"
  placeholder="搜索游戏..."
/>

<div class="games-grid" v-loading="gameStore.loading">
  <GameCard
    v-for="game in gameStore.filteredGames"
    :key="game.id"
    :game="game"
  />
</div>
```

### 组件间嵌套关系

组件间的嵌套关系形成了清晰的层次结构：
- `App.vue` → `HomePage.vue` → `GameCard.vue`
- `App.vue` → `AdminLoginPage.vue`
- `App.vue` → `AdminLayout.vue` → `AdminGamesPage.vue`

这种层次化的设计使得组件职责明确，便于维护和测试。

**Section sources**
- [HomePage.vue](file://frontend\src\views\HomePage.vue#L1-L307)
- [GameCard.vue](file://frontend\src\components\GameCard.vue#L1-L288)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue#L1-L230)
- [App.vue](file://frontend\src\App.vue#L1-L63)

## SVG图标封装与复用策略

项目在`components/icons/`目录下封装了多个SVG图标组件，但当前代码中未找到具体的图标组件文件。项目使用Element Plus的图标组件：

```vue
<script setup lang="ts">
import { Search, User, Refresh } from '@element-plus/icons-vue'
</script>

<template>
  <el-input
    v-model="gameStore.searchQuery"
    placeholder="搜索游戏..."
    :prefix-icon="Search"
    class="search-input"
    clearable
  />
  <el-button 
    @click="refreshGames"
    :loading="gameStore.loading"
    :icon="Refresh"
    circle
    title="刷新游戏列表"
  />
  <el-button 
    type="primary" 
    @click="goToAdminLogin"
    :icon="User"
  >
    管理员登录
  </el-button>
</template>
```

这种使用Element Plus图标的优势包括：
1. **开箱即用**：无需手动创建SVG组件
2. **样式统一**：与Element Plus组件风格一致
3. **按需加载**：只导入使用的图标，减少打包体积
4. **类型安全**：与TypeScript集成良好

**Section sources**
- [HomePage.vue](file://frontend\src\views\HomePage.vue#L1-L307)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue#L1-L230)

## 状态管理与类型系统

### Pinia状态管理

项目使用Pinia进行状态管理，`game.ts`定义了游戏状态：

```ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { gameService } from '@/services/gameService'
import { filterGamesByStatus } from '@/utils/gameFilter'
import type { GameListItem, GameFilterType } from '@/types/game'

export const useGameStore = defineStore('game', () => {
  // 状态
  const games = ref<GameListItem[]>([])
  const loading = ref(false)
  const searchQuery = ref('')
  const statusFilter = ref<GameFilterType>('all' as GameFilterType)
  const error = ref<string | null>(null)

  // 计算属性
  const filteredGames = computed(() => {
    return filterGamesByStatus(games.value, statusFilter.value, searchQuery.value)
  })

  // 操作
  const loadGames = async () => {
    loading.value = true
    error.value = null
    
    try {
      const response = await gameService.getGames({ filter: statusFilter.value })
      if (response.success && response.data) {
        games.value = response.data
      } else {
        throw new Error(response.error?.message || '获取游戏列表失败')
      }
    } catch (err) {
      console.error('加载游戏列表失败:', err)
      error.value = err instanceof Error ? err.message : '加载游戏列表失败'
    } finally {
      loading.value = false
    }
  }

  const refreshGames = async () => {
    await loadGames()
  }

  const setSearchQuery = (query: string) => {
    searchQuery.value = query
  }

  const setStatusFilter = (filter: GameFilterType) => {
    statusFilter.value = filter
  }

  const clearError = () => {
    error.value = null
  }

  return {
    // 状态
    games,
    loading,
    searchQuery,
    statusFilter,
    error,
    // 计算属性
    filteredGames,
    // 操作
    loadGames,
    refreshGames,
    setSearchQuery,
    setStatusFilter,
    clearError
  }
})
```

`admin.ts`定义了管理员状态：

```ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { adminService } from '@/services/adminService'
import type { AdminUser, LoginCredentials } from '@/types/admin'

export const useAdminStore = defineStore('admin', () => {
  // 状态
  const isLoggedIn = ref(false)
  const userInfo = ref<AdminUser | null>(null)
  const token = ref<string | null>(null)
  const loading = ref(false)
  const error = ref<string | null>(null)

  // 计算属性
  const isSuperAdmin = computed(() => {
    return userInfo.value?.is_super_admin || false
  })

  // 初始化检查登录状态
  const initAuth = async () => {
    const savedToken = localStorage.getItem('admin_token')
    const savedUser = localStorage.getItem('admin_user')
    
    if (savedToken && savedUser) {
      try {
        token.value = savedToken
        userInfo.value = JSON.parse(savedUser)
        
        // 验证token是否有效（可选）
        // 这里可以添加一个验证接口调用
        
        isLoggedIn.value = true
      } catch (err) {
        console.warn('清除无效的管理员登录信息:', err)
        // 清除无效数据
        logout()
      }
    }
  }

  // 登录操作
  const login = async (credentials: LoginCredentials) => {
    loading.value = true
    error.value = null
    
    try {
      const response = await adminService.login(credentials)
      
      if (response.success) {
        token.value = response.token
        userInfo.value = response.user
        isLoggedIn.value = true
        
        // 保存到本地存储
        localStorage.setItem('admin_token', response.token)
        localStorage.setItem('admin_user', JSON.stringify(response.user))
        
        return { success: true }
      } else {
        throw new Error(response.message || '登录失败')
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : '登录失败'
      error.value = errorMessage
      return { success: false, error: errorMessage }
    } finally {
      loading.value = false
    }
  }

  // 登出操作
  const logout = () => {
    token.value = null
    userInfo.value = null
    isLoggedIn.value = false
    
    // 清除本地存储
    localStorage.removeItem('admin_token')
    localStorage.removeItem('admin_user')
  }

  // 清除错误
  const clearError = () => {
    error.value = null
  }

  return {
    // 状态
    isLoggedIn,
    userInfo,
    token,
    loading,
    error,
    // 计算属性
    isSuperAdmin,
    // 操作
    initAuth,
    login,
    logout,
    clearError
  }
})
```

### TypeScript类型系统

项目使用TypeScript定义了清晰的类型系统，`game.ts`定义了游戏相关类型：

```ts
// 游戏状态枚举
export enum GameStatus {
  WAITING = 'waiting',
  RUNNING = 'running',
  PAUSED = 'paused',
  ENDED = 'ended',
  HIDDEN = 'hidden',
  DELETED = 'deleted'
}

// 游戏筛选类型
export enum GameFilterType {
  ALL = 'all',           // 全部（不包括已隐藏）
  ACTIVE = 'active',     // 活动中（等待中、进行中、已暂停）
  WAITING = 'waiting',   // 等待中
  RUNNING = 'running',   // 进行中
  ENDED = 'ended',       // 已结束
  HIDDEN = 'hidden'      // 已隐藏
}

// 游戏列表项
export interface GameListItem {
  id: string
  name: string
  description?: string
  status: GameStatus
  player_count: number
  max_players: number
  created_at: string
}
```

`admin.ts`定义了管理员相关类型：

```ts
// 管理员用户信息
export interface AdminUser {
  id: string
  username: string
  is_super_admin: boolean
  created_at: string
  updated_at: string
}

// 登录凭据
export interface LoginCredentials {
  username: string
  password: string
}

// 登录响应
export interface LoginResponse {
  success: boolean
  token: string
  user: AdminUser
  message?: string
}
```

**Section sources**
- [game.ts](file://frontend\src\stores\game.ts#L1-L72)
- [admin.ts](file://frontend\src\stores\admin.ts#L1-L102)
- [game.ts](file://frontend\src\types\game.ts#L1-L91)
- [admin.ts](file://frontend\src\types\admin.ts#L1-L72)

## 组件体系架构图

``mermaid
graph TD
A[App.vue] --> B[HomePage.vue]
A --> C[AdminLoginPage.vue]
A --> D[AdminLayout.vue]
B --> E[GameCard.vue]
D --> F[AdminGamesPage.vue]
D --> G[AdminRulesPage.vue]
D --> H[AdminUsersPage.vue]
E --> I[Element Plus Icons]
F --> I
G --> I
H --> I
style A fill:#4CAF50,stroke:#388E3C
style B fill:#2196F3,stroke:#1976D2
style C fill:#FF9800,stroke:#F57C00
style D fill:#9C27B0,stroke:#7B1FA2
style E fill:#00BCD4,stroke:#0097A7
style F fill:#FF5722,stroke:#D84315
style G fill:#795548,stroke:#5D4037
style H fill:#607D8B,stroke:#455A64
style I fill:#9E9E9E,stroke:#616161
click A "file://frontend\src\App.vue"
click B "file://frontend\src\views\HomePage.vue"
click C "file://frontend\src\views\admin\AdminLoginPage.vue"
click D "file://frontend\src\views\admin\AdminLayout.vue"
click E "file://frontend\src\components\GameCard.vue"
click F "file://frontend\src\views\admin\AdminGamesPage.vue"
click G "file://frontend\src\views\admin\AdminRulesPage.vue"
click H "file://frontend\src\views\admin\AdminUsersPage.vue"
click I "file://frontend\src\views\HomePage.vue"
```

**Diagram sources**
- [App.vue](file://frontend\src\App.vue)
- [HomePage.vue](file://frontend\src\views\HomePage.vue)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue)
- [AdminLayout.vue](file://frontend\src\views\admin\AdminLayout.vue)
- [GameCard.vue](file://frontend\src\components\GameCard.vue)
- [AdminGamesPage.vue](file://frontend\src\views\admin\AdminGamesPage.vue)
- [AdminRulesPage.vue](file://frontend\src\views\admin\AdminRulesPage.vue)
- [AdminUsersPage.vue](file://frontend\src\views\admin\AdminUsersPage.vue)

**Section sources**
- [App.vue](file://frontend\src\App.vue)
- [HomePage.vue](file://frontend\src\views\HomePage.vue)
- [AdminLoginPage.vue](file://frontend\src\views\admin\AdminLoginPage.vue)
- [AdminLayout.vue](file://frontend\src\views\admin\AdminLayout.vue)
- [GameCard.vue](file://frontend\src\components\GameCard.vue)
- [AdminGamesPage.vue](file://frontend\src\views\admin\AdminGamesPage.vue)
- [AdminRulesPage.vue](file://frontend\src\views\admin\AdminRulesPage.vue)
- [AdminUsersPage.vue](file://frontend\src\views\admin\AdminUsersPage.vue)